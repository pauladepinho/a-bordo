<%- include("partials/header.ejs", { title: "aBordo - Lançar notas" }) %>
<link rel='stylesheet' href='/stylesheets/set-notes.css' />
</head>

<body>
  <header>
    <div id="logo">
      <img class="logo" src="../images/airplane.svg" alt="">
      <h1 class="logo">aBordo</h1>
    </div>
    <div id="top-right-menu">
      <div id="notifications">
        <img src="../images/sino.png" alt=" ">
      </div>
      <div id="user-options">
        <img src="../images/professor.png" alt="">
        <span>
          <p>Nome do professor</p>
          <p>PROFESSOR</p>
        </span>
      </div>
    </div>
  </header>

  <nav>
    <div class="navbar select">
      <select name="school" id="school" required>
        <option value="" disabled selected>Escola</option>
        <option value="0">Colégio Pedro II</option>
        <option value="1">Escola Técnica Estadual do Ensino Fundamental Visconde de Mauá
      </select>

      <select name="class" id="class" required>
        <option value="" disabled selected>Turma</option>
        <option value="2223">Turma 2223</option>
        <option value="1121">Turma 1121</option>
      </select>

      <select id="course" name="course" required>
        <option value="" disabled selected>Disciplina</option>
        <option value="arts">Artes</option>
        <option value="biology">Biologia</option>
        <option value="sciences">Ciências</option>
        <option value="phys-ed">Educação Física</option>
        <option value="philosophy">Filosofia</option>
        <option value="physics">Física</option>
        <option value="geography">Geografia</option>
        <option value="geomethy">Geometria</option>
        <option value="history">História</option>
        <option value="literature">Literatura</option>
        <option value="math">Matemática</option>
        <option value="music">Música</option>
        <option value="spanish-lang">Língua Espanhola</option>
        <option value="french-lang">Língua Francesa</option>
        <option value="english-lang">Língua Inglesa</option>
        <option value="portuguese-lang">Língua Portuguesa</option>
        <option value="chemistry">Química</option>
        <option value="writing">Redação</option>
        <option value="sociology">Sociologia</option>
        <option value="drama">Teatro</option>
      </select>

      <select name="term" id="term" required>
        <option value="" disabled selected>Trimestre</option>
        <option value="1">1º Trimestre</option>
        <option value="2">2º Trimestre</option>
        <option value="3">3º Trimestre</option>
      </select>
    </div>

    <div class="navbar">
      <ul class="nav">
        <li><a class="nav-link" href="/fazer-chamada">
            Fazer chamada
          </a></li>
        <li><a class="nav-link active" href="#">
            Lançar notas
          </a></li>
        <li><a class="nav-link" href="/ver-diario-de-classe">
            Diário de classe
          </a></li>
        <li><a class="nav-link" href="#">
            Estatísticas
          </a></li>
        <li><a class="nav-link" href="#">
            Contatar responsáveis
          </a></li>
      </ul>
    </div>
  </nav>

  <% 
    var students = [
      {id: 0, name: "Andeilso Alves", number: 1}, 
      {id: 1, name: "Patrícia Felix", number: 2}, 
      {id: 2, name: "Paula de Pinho Monteiro", number: 3}, 
      {id: 3, name: "João de Oliveira da Silva Santos", number: 7}
    ];
    var evaluations = [
      { number: 1, date: null, maxGrade: 10, grade: 5, title: "AVAL. 1", color: "#54A2EB", student_id: null },
      { number: 2, date: null, maxGrade: 10, grade: 2, title: "AVAL. 2", color: "#ff92aa", student_id: null },      
      { number: 3, date: null, maxGrade: 10, grade: 3, title: "AVAL. 3", color: "#fae155", student_id: null },      
      { number: 4, date: null, maxGrade: 10, grade: 10, title: "AVAL. 4", color: "#C979FB", student_id: null }, 
      { number: 5, date: null, maxGrade: 10, grade: null, title: "AVAL. 5", color: "#FFAC60", student_id: null }, 
      { number: 6, date: null, maxGrade: 10, grade: null, title: "AVAL. 6", color: "#41E5AA", student_id: null }
    ]; 
  %>

  <% 
    let possibleTotalPoints = 0;
    evaluations.forEach(evaluation => {
      possibleTotalPoints += Number(evaluation.maxGrade);
    });
  %>

  <main id="grade">
    <section class="table-settings">
      <div class="selectors">
        <select name="evaluation" id="qnt-bars">
          <option value="" selected disabled>Selecione uma avaliação</option>
          <% evaluations.forEach(evaluation => { %>
          <option value=<%= evaluation.number %>>
            <%= evaluation.title %>
          </option>
          <% }) %>
          <option value="+">Adicionar uma nova avaliação</option>
          <option value="-" disabled>Excluir avaliação selecionada</option>
        </select>
      </div>

      <div class="chart">
        <div id="instructions">
          <p>Valor de cada avaliação:</p>
          <div id="disclaimer"></div>
        </div>
        <div id="input-fields">
          <% evaluations.forEach(evaluation => { %>
          <div>
            <label class="title" style=<%= "color:" + evaluation.color %>> <%= evaluation.title %>
            </label>
            <input class="<%= 'max-grade evaluation' + evaluation.number %>" type='number'
              value="<%= evaluation.maxGrade.toFixed(1) %>" step='0.5' min='0' max='10'
              name=<%= "max-grade-evaluation" + evaluation.number %>>
          </div>
          <% }) %>
        </div>
        <div id="container">
          <% evaluations.forEach(evaluation => { %>
          <div class="<%= 'bar evaluation' + evaluation.number %>"
            style="<%= 'width:' + Math.round(100 * (evaluation.maxGrade / possibleTotalPoints)) + '%; background-color:' + evaluation.color %>">
          </div>
          <% }) %>
        </div>
      </div>
    </section>

    <section class="table">
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="student-number">Nº</th>
            <th class="student-name">ALUNO</th>

            <% evaluations.forEach(evaluation => { %>
            <th class="<%= 'evaluation evaluation' + evaluation.id %>"><label class="title"
                style=<%= 'color:' + evaluation.color %>><%= evaluation.title %></label></th>
            <% }) %>

            <th class="not-evaluated" id="not-evaluated-header">N/A</th>
            <th class="term-final-grade">MÉDIA</th>
          </tr>
        </thead>
        <tbody>
          <% students.forEach(student => { %>
          <tr>
            <td class="student-number"><%= student.number %></th>
            <td class="student-name"><%= student.name %></td>


            <% evaluations.forEach(evaluation => { 
              this.student_id = student.id;
            %>

            <td class="<%= 'evaluation evaluation' + evaluation.id %>" %>>
              <input type="number" name=<%= "student" + student.id + "-grades[]" %> max="10" min="0" step="0.5"
                value="<%= evaluation.grade %>" placeholder="Nota" disabled></td>

            <% }) %>


            <td class="not-evaluated" id=<%= "student" + student.id + "not-evaluated-check" %>><label
                for="not-evaluated" class="checkbox-container">
                <input type="checkbox" name="not-evaluated" id="not-evaluated" />
                <span class="checkmark"></span>
              </label></td>

            <% 
              let totalPoints = 0;
              let gradedEvaluations = 0;
              evaluations.forEach(evaluation => {
                if(evaluation.grade != null) {
                  totalPoints += Number(evaluation.grade);
                  gradedEvaluations++;
                }
              });
            %>
            <td class="term-final-grade" id=<%= "student" + student.id + "-term-final-grade" %>>
              <%= Math.round(totalPoints / gradedEvaluations).toFixed(1) %> </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </section>
  </main>

  <%- include("partials/footer.ejs") %>